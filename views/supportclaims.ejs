<html lang="en">
<head>
  <script src="/static/script.js"></script>
  <!--   BOOTSTRAP -->
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
<link rel="stylesheet" href="/style.css" type="text/css">

<!-- jQuery library -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

<!-- Popper JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>

<!-- Latest compiled JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
</head>

<body id="home" class="container">
    <h1 id= "hometitle" class = "h1 text-center mt-5">Claims for <%= title %> <%= id %></h1>
    
  <div class = "row">
    <div class = "col-sm-6">
    <form action="/supportviews/<%= claimtype%>/<%= id %>/status" formmethod="GET">
      <input type="radio" id="Open" name="status" value="Open">
      <label for="Open">Open</label><br>
      <input type="radio" id="Closed" name="status" value="Closed">
      <label for="closed">Closed</label><br>
      <input type="submit" value="Submit" id = "homebtn" class = "btn btn-success h-50" >
    </form><br>
  </div>
    <div class = "col-sm-6">
      <form action="/supportviews/<%= claimtype%>/<%= id%>/date" formmethod="GET">
      <input type="radio" id="Oldest" name="order" value="asc">
      <label for="Oldest">Oldest</label><br>
      <input type="radio" id="Newest" name="order" value="desc">
      <label for="Newest">Newest</label><br>
      <input type="submit" value="Submit" id = "homebtn" class = "btn btn-success h-50">
    </form><br>
    </div>
  <form action="/supportviews/<%= claimtype%>/<%= id%>" formmethod"GET">
      <input type="submit" value="Reset" id = "homebtn" class = "btn btn-success h-50">
    </form><br>
  </div>
    <% if (claims) { %>
    <p>You have <%= claims.length %> claims.</p>
    <table class="table">
      <tbody><tr><th>ID</th><th>Customer</th><th>Product</th><th>Status</th><th>Date Opened</th><th>Action</th></tr>
        <% claims.forEach(function(claim){ %>
        <tr>
          <td><%= claim.claimid %></td>
          <td><%= claim.customer %></td>
          <td><%= claim.product %></td>
          <td><%= claim.status %></td>
          <td><%= claim.dateopened%> </td>
          <td><form action="/supportviews/<%= claimtype%>/claim/<%= claim.claimid%>" method="GET"><input type="submit" value="See Details" id = "homebtn" class = "btn btn-success h-50"></form><br><br></td>
        </tr>
        <% }); %>
      </tbody>
    </table>
    <% } else { %>
    <p>There are no books in the database.</p>
    <% } %>
  
  
  
  
    <!-- include the Glitch button to show what the webpage is about and
to make it easier for folks to view source and remix -->
    <div class="glitchButton" style="position:fixed;top:20px;right:20px;"></div>
    <script src="https://button.glitch.me/button.js"></script>
  </body>

  <script type=text/javascript>
  
  function addComment(){
    document.getElementById("addComment").style.display = "block";
  }
  
  function resolve(){
    var resolution = document.getElementById('resolutionList').value;
    var claim = document.getElementById('resolveform').value
    var comment = document.getElementById('comment').value;
    if (comment != ""){
      //Send comment
      fetch('https://techmagic.glitch.me/api/claims/comments', {
        headers:{
          "content-type":"application/json",
        },
        body: JSON.stringify({
          claimid:claim,
          description:comment,
          employeeid: 1
        }),
        method: 'POST'
        }).then(resp=>{
        }, err=>{
          console.log(err);
        })
    }
    fetch('https://techmagic.glitch.me/api/resolutions/update/close', {
        headers:{
          "content-type":"application/json",
        },
        body: JSON.stringify({
          resolutionid: resolution,
          claimid: claim
        }),
        method: 'PUT'
    }).then(resp=>{
    }, err=>{
      console.log(err);
    })
    window.location.reload();//so changes render
  }
  
  function resolveModal(ele){
    var modal = document.getElementById("descriptionModal"); 
    var closeBtn = document.getElementsByClassName("close")[0];
    document.getElementById("resolveform").value=ele
    modal.style.display = "block";
    //close out of modal either when clicking 'x' 
    closeBtn.onclick = function() {
      modal.style.display = "none";
    }
    //or close modal when clicking outside of the modal
    window.onclick = function(event) {
      if (event.target == modal) {
      modal.style.display = "none";
      }
    }
  }
  
  function closeClaim(id, prod){
   fetch('https://techmagic.glitch.me/api/claims/update', {
        headers:{
          "content-type":"application/json",
        },
        body: JSON.stringify({
          claimid: id,
          status: "Closed"
        }),
        method: 'PUT'
    }).then(resp=>{
    }, err=>{
      console.log(err);
    })
    window.location.reload();//so changes render
  }
  
  function openClaim(id, prod){
    fetch('https://techmagic.glitch.me/api/claims/update', {
        headers:{
          "content-type":"application/json",
        },
        body: JSON.stringify({
          claimid: id,
          status: "Open"
        }),
        method: 'PUT'
    }).then(resp=>{
    }, err=>{
      console.log(err);
    })
    window.location.reload();//so changes render
  }
  
  function addFilterCustomer(ele) {
    var rows = document.getElementsByTagName("tr").length
    for (var i = 1; i< rows; i++){
      if  (document.getElementsByTagName("tr")[i].children[1].innerText != ele.text ){
         document.getElementsByTagName("tr")[i].style.display="none"
      }
    } 
    document.getElementById('create').style.display="block";
    var button = document.createElement('button');
    button.innerHTML = ele.text;
    button.setAttribute("id", ele.text)
    button.onclick = function () {removeFilter(ele.text);}
    document.getElementById('create').appendChild(button)
  } 
  
  function addFilterEmployee(ele) {
    var rows = document.getElementsByTagName("tr").length
    for (var i = 1; i< rows; i++){
      if  (document.getElementsByTagName("tr")[i].children[5].innerText != ele.text ){
        document.getElementsByTagName("tr")[i].style.display="none"
      }
    }   
    document.getElementById('create').style.display="block";
    var button = document.createElement('button');
    button.innerHTML = ele.text;
    button.setAttribute("id", ele.text)
    button.onclick = function () {removeFilter(ele.text);}
    document.getElementById('create').appendChild(button)
  } 
  
  function addFilterProduct(ele) {
    var rows = document.getElementsByTagName("tr").length
    for (var i = 1; i< rows; i++){
      if  (document.getElementsByTagName("tr")[i].children[2].innerText != ele.text ){
        document.getElementsByTagName("tr")[i].style.display="none"
      }
    }   
    document.getElementById('create').style.display="block";
    var button = document.createElement('button');
    button.innerHTML = ele.text;
    button.setAttribute("id", ele.text)
    button.onclick = function () {removeFilter(ele.text);}
    document.getElementById('create').appendChild(button)
  }
  
  function removeFilter(val) {
    document.getElementById(val).remove();
    console.log(val);
    var rows = document.getElementsByTagName("tr").length;
    for (var i = 1; i< rows; i++){
      if(document.getElementsByTagName("tr")[i].children[1].innerText != val ){
        document.getElementsByTagName("tr")[i].style.display="contents";
      }
    }
  }  
   
  function searchMenu() {
    var menuBox = document.getElementById('menu-box');    
    if(menuBox.style.display == "block") { 
      menuBox.style.display = "none";
    }
    else {
      menuBox.style.display = "block";
      menuBox.addEventListener('mouseleave', function(){
      closeMenu();
      });
    }
  }
  
  function closeMenu(){
    var menuBox = document.getElementById('menu-box');    
    if(menuBox.style.display == "block") { 
    menuBox.style.display = "none";
    }
  }  

  //sort by Customer
  function sortCustomer(column, direction){
    console.log("sort");
    let rows = document.getElementsByTagName("tbody");
    rows = [].slice.call(rows);
    rows.sort(function(a,b){
      return a.rows[0].cells[1].innerText.localeCompare(b.rows[0].cells[1].innerText);
    });
    let table = document.getElementById("table");
    let blep = document.getElementsByTagName("tbody");
    while (blep.length >0){
      table.removeChild(blep[0]);
    }
    for(let k =0; k < rows.length; k++){
      table.appendChild(rows[k]);
    }
  }
  
  //sort by Product
  function sortProduct(column, direction){
    console.log("sort");
    let rows = document.getElementsByTagName("tbody");
    rows = [].slice.call(rows);
    rows.sort(function(a,b){
      return a.rows[0].cells[2].innerText.localeCompare(b.rows[0].cells[2].innerText);
    });

    let table = document.getElementById("table");
    let blep = document.getElementsByTagName("tbody");
    while (blep.length >0){
      table.removeChild(blep[0]);
    }

    for(let k =0; k < rows.length; k++){
      table.appendChild(rows[k]);
    }
  }
  
  //sort by Status
  function sortStatus(column, direction){
    console.log("sort");
    let rows = document.getElementsByTagName("tbody");
    rows = [].slice.call(rows);
    rows.sort(function(a,b){
      return a.rows[0].cells[7].innerText.localeCompare(b.rows[0].cells[7].innerText);
    });
    let table = document.getElementById("table");
    let blep = document.getElementsByTagName("tbody");
    while (blep.length >0){
      table.removeChild(blep[0]);
    }
    for(let k =0; k < rows.length; k++){
      table.appendChild(rows[k]);
    }
  } 

</script>
  
<%- include("partials/footer") %>