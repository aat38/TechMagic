<%- include("partials/header") %>

<% if (locals.products) { %> 
<h1>
  Products
</h1>
<table class="table table-hover">
  <thead>
    <tr>
      <th>Name</th>
      <th>Unit Cost</th>
    </tr>
  </thead>
  <tbody>
  <% products.forEach(result=>{ %>
    <tr > 
      <td><input type="button" class="clickable-row" onclick="getId(this)" name='<%=result.description%>,<%=result.productid%>' value='<%=result.name%>'></td>
      <td><input type="button" class="clickable-row" onclick="getId(this)" name='<%=result.description%>,<%=result.productid%>' value='<%=result.unitcost%>'></td>
    </tr>
  <%})%>
  <% } %>
  </tbody>
 
    
<div id="descriptionModal" class="modal">
  <!-- Modal content -->
  <div class="modal-content">
    <span class="close">&times;</span>
    <div>
      <h2 id="name">Product Name</h2>
      <p id="description">Product description</p>
      <button id="claims">View Claims for this Product</button>
    </div>
  </div>
</div>
  
<button><a href="/">Admin Home</a></button>

  
<script type=text/javascript>
 
  function  getId(element) {
    var num;
    fetch('https://ejs-views-practice.glitch.me/api/claims/products/'+element.name.split(",")[1], {
        headers:{
          "content-type":"application/json",
        },
        method: 'GET'
    }).then(resp=>{
      console.log("RESPONSE" +resp)
       console.log(JSON.stringify(resp).length)
    }, err=>{
      console.log(err);
    })
        
    var product=element.value
    var description=element.name.split(",")[0];
    var modal = document.getElementById("descriptionModal");

    document.getElementById("name").innerHTML=product;
    document.getElementById("description").innerHTML=description;
    document.getElementById("claims").innerHTML="View "+ num+ " claims for this product";
    modal.style.display = "block";
    
    var closeBtn = document.getElementsByClassName("close")[0];
    
    closeBtn.onclick = function() {
      modal.style.display = "none";
    }
    window.onclick = function(event) {
      if (event.target == modal) {
      modal.style.display = "none";
      }
    }
}
  
</script>


<%- include("partials/footer") %>

