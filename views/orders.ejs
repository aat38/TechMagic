<%- include("partials/header") %>
<!-- need to import purchase and productPurchase tables -->


<% if (locals.customers){%>
<h1>Orders</h1>
<%- include("partials/vieworder") %>
<p>
  Goals for this page: create purchases(orders), create claims based on purchases, view purchases âœ“
</p>

<button onclick="orderModal()">Create Order</button>

<table id="table" class="table table-hover">
  <thead>
    <tr>
      <th></th>
      <th>Order Number</th>
      <th>Customer</th>
      <th>Total Price</th>
      <th>Date</th>
    </tr>
  </thead>
  <% purchase.forEach(result=>{ %>
  <% var datePurchase = new Date(result.date) %>
  <% var datePurchase = (datePurchase.getMonth()+1) + "/" + datePurchase.getDate() + "/" +  datePurchase.getFullYear() %>

  <tbody>
    <tr>
      <td><button><a href="/purchases/<%=result.purchaseid%>">View Order</a></button></td>
      <td><%=result.purchaseid%></td>
      <td><%=customers[result.customerid-1].firstname%> <%=customers[result.customerid-1].lastname%></td>
      <td><%=result.totalcost%></td>
      <td><%=datePurchase%></td>
     </tr> 
  </tbody>
  <%})%>
</table>

<!--  Create Order Modal  (need customer list and product list)-->
  <div id="createOrderModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span><!-- close button -->
      <div class="d-flex justify-content-center flex-column">
        <form id="createform"> 
          <div>
            <b>Customer: </b>
            <select id="customerList">
            <% if (locals.customers) { %> 
              <% customers.forEach(customer=>{ %>
              <option value='<%=customer.customerid%>'><%=customer.firstname %> <%=customer.lastname %></option>
              <% } )%>
            <% } %>
            </select>
          </div>
          <b>Products Purchased:</b>
          <div id="product">
            <select id="productList">
            <% if (locals.products) { %> 
              <% products.forEach(product=>{ %>
              <option value='<%=product.productid%>;<%=product.unitcost%>'><%=product.name%></option>
              <% } )%>
            <% } %>
            </select>
          </div>          
          <div><button onclick="createProductDiv('<%=locals.products%>')">+</button>Add Product Purchase</div>
          <button id="updateBtn" onclick="update();">Submit New Order</button>
        </form>
      </div>
    </div>
  </div>


<%}else{%>
<h1>
 No Orders Found
</h1>
<%}%>

<script>
  var count=0
  document.getElementById("updateBtn").addEventListener("click", function(){
    count = count +1;
  });
  
  function createProductDiv(products){
     var x = document.createElement(div);
  // x.setAttribute("id", "mySelect");
    document.getElementById('product').appendChild(x)

//   var z = document.createElement("option");
//   z.setAttribute("value", "volvocar");
//   var t = document.createTextNode("Volvo");
//   z.appendChild(t);
//   document.getElementById("mySelect").appendChild(z);
  }
  
  function orderModal() {
      var modal = document.getElementById("createOrderModal"); 
      var closeBtn = document.getElementsByClassName("close")[0];
      modal.style.display = "block";
      //close out of modal either when clicking 'x' 
      closeBtn.onclick = function() {
        modal.style.display = "none";
      }
      //or close modal when clicking outside of the modal
      window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        }
      }
  } 
  
  function createProductDiv(){
    
  }
  

</script>




<%- include("partials/footer") %>